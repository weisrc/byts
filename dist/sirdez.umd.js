(function(s,l){typeof exports=="object"&&typeof module!="undefined"?l(exports):typeof define=="function"&&define.amd?define(["exports"],l):(s=typeof globalThis!="undefined"?globalThis:s||self,l(s.sd={}))})(this,function(s){"use strict";function l(e=4096){const n=new ArrayBuffer(e);return{i:0,view:new DataView(n),bytes:new Uint8Array(n)}}function g(e){e.bytes=new Uint8Array(e.bytes.length*2),e.view=new DataView(e.bytes.buffer)}function b(e,n,i){for(;;){const t=e.bytes.length-8;e.i=0;try{if(n(e,i),e.i<t)return e.bytes}catch(o){if(e.i<t)throw o}g(e)}}function y(e,n,i){const{length:t}=i;return t<4096?(e.bytes.set(i),e.i=0,n(e)):n(v(i))}function v(e){return{i:0,bytes:e,view:new DataView(e.buffer,e.byteOffset,e.byteLength)}}function f(e,n){return{ser:e,des:n}}const m={encode(e,n){const{length:i}=n;for(let t=0;t<i;t++)e.view.setUint8(e.i++,n.charCodeAt(t))},decode(e,n){const i=new Array(n);for(let t=0;t<n;t++)i[t]=e.view.getUint8(e.i++);return String.fromCharCode(...i)}},$={encode(e,n){const{length:i}=n;for(let t=0;t<i;t++)e.view.setUint16(e.i,n.charCodeAt(t)),e.i+=2},decode(e,n){const i=n/2,t=new Array(i);for(let o=0;o<i;o++)t[o]=e.view.getUint16(e.i),e.i+=2;return String.fromCharCode(...t)}},j=new TextEncoder,C=new TextDecoder,A={encode(e,n){e.i+=j.encodeInto(n,e.bytes.subarray(e.i)).written},decode:(e,n)=>C.decode(e.bytes.subarray(e.i,e.i+=n))},O={encode(e,n){const{length:i}=n;for(let t=0;t<i;t++){const o=n.charCodeAt(t);if(o<128)e.view.setUint8(e.i,o),e.i++;else if(o<2048){const r=(o&1984)<<2,c=o&63;e.view.setUint16(e.i,r|c|49280),e.i+=2}else if(o<55296||o>=57344){const r=(o&61440)<<12,c=(o&4032)<<10,d=(o&63)<<8;e.view.setUint32(e.i,r|c|d|3766517760),e.i+=3}else{const r=n.codePointAt(t++),c=(r&1835008)<<6,d=(r&258048)<<4,w=(r&4032)<<2,a=r&63;e.view.setUint32(e.i,c|d|w|a|4034953344),e.i+=4}}},decode(e,n){const i=[],t=e.i+n;for(;e.i<t;){const o=e.view.getUint8(e.i);if(o<192)i.push(o),e.i++;else if(o<224){const r=e.view.getUint8(e.i+1);e.i+=2,i.push((o&31)<<6|r&63)}else if(o<240){const r=e.view.getUint8(e.i+1),c=e.view.getUint8(e.i+2);e.i+=3,i.push((o&15)<<12|(r&63)<<6|c&63)}else{const r=e.view.getUint32(e.i),c=(o&7)<<18,d=(r&4128768)>>4,w=(r&16128)>>2,a=r&63;i.push(c|d|w|a),e.i+=4}}return String.fromCodePoint(...i)}},B=(e,n)=>f((i,t)=>{const{length:o}=t;n.ser(i,o);for(let r=0;r<o;r++)e.ser(i,t[r])},i=>{const t=n.des(i),o=new Array(t);for(let r=0;r<t;r++)o[r]=e.des(i);return o}),D=e=>f((n,i)=>{i==null?n.view.setUint8(n.i++,0):(n.view.setUint8(n.i++,1),e.ser(n,i))},n=>n.view.getUint8(n.i++)?e.des(n):void 0),T=(e,n,i)=>f((t,o)=>{const{length:r}=Object.keys(o);n.ser(t,r);for(const c in o)i.ser(t,c),e.ser(t,o[c])},t=>{const o=n.des(t),r={};for(let c=0;c<o;c++)r[i.des(t)]=e.des(t);return r}),F=(e,n)=>f((i,t)=>{const o=i.i;n.ser(i,0);const r=i.i;e.encode(i,t);const c=i.i,d=c-r;i.i=o,n.ser(i,d),i.i=c},i=>e.decode(i,n.des(i))),I=e=>f((n,i)=>{const{byteLength:t}=i;e.ser(n,t),n.bytes.set(i,n.i),n.i+=t},n=>{const i=e.des(n);return n.bytes.subarray(n.i,n.i+=i)}),L=f((e,n)=>void e.view.setUint8(e.i++,+n),e=>!!e.view.getUint8(e.i++)),h=e=>isNaN(+e)?JSON.stringify(e):e,U=e=>{const n=Object.keys(e),i=Object.keys(n).map(o=>+o),t=Object.values(e);return new Function("d",`[${i.map(o=>"k"+o).join()}]`,`[${i.map(o=>"s"+o).join()}]`,`[${i.map(o=>"d"+o).join()}]`,`return d((c,d)=>{${i.map(o=>`s${o}(c,d[${h(n[o])}])`).join(";")}},(c)=>{const d=${e instanceof Array?"[]":"{}"};${i.map(o=>`d[${h(n[o])}]=d${o}(c)`).join(";")};return d})`)(f,n,t.map(({ser:o})=>o),t.map(({des:o})=>o))},N=(...e)=>U(e),u=(e,n)=>{const i=e[0].toUpperCase()+e.slice(1)+n,t=n/8;return new Function("d",`return d((c,d)=>{c.view.set${i}(c.i,d);c.i+=${t}},(c)=>{const d=c.view.get${i}(c.i);c.i+=${t};return d})`)(f)},P=u("uint",8),V=u("uint",16),k=u("uint",32),M=u("int",8),_=u("int",16),E=u("int",32),J=u("bigUint",64),S=u("bigInt",64),q=u("float",32),z=u("float",64);function G({ser:e,des:n}){const i=l();return{ser:e,des:n,toBytes:t=>b(i,e,t).slice(0,i.i),toUnsafeBytes:t=>b(i,e,t).subarray(0,i.i),fromBytes:t=>y(i,n,t)}}s.array=B,s.bigInt64=S,s.bigUint64=J,s.boolean=L,s.bytes=I,s.contextDes=y,s.contextFromBytes=v,s.contextSer=b,s.createContext=l,s.define=f,s.float32=q,s.float64=z,s.growContext=g,s.int16=_,s.int32=E,s.int8=M,s.latin1=m,s.number=u,s.optional=D,s.record=T,s.string=F,s.struct=U,s.tuple=N,s.ucs2=$,s.uint16=V,s.uint32=k,s.uint8=P,s.use=G,s.utf8=A,s.utf8js=O,Object.defineProperty(s,"__esModule",{value:!0}),s[Symbol.toStringTag]="Module"});
