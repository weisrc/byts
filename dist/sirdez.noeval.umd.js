(function(s,l){typeof exports=="object"&&typeof module!="undefined"?l(exports):typeof define=="function"&&define.amd?define(["exports"],l):(s=typeof globalThis!="undefined"?globalThis:s||self,l(s.sd={}))})(this,function(s){"use strict";function l(e=4096){const n=new ArrayBuffer(e);return{i:0,view:new DataView(n),bytes:new Uint8Array(n)}}function v(e){e.bytes=new Uint8Array(e.bytes.length*2),e.view=new DataView(e.bytes.buffer)}function g(e,n,i){for(;;){const t=e.bytes.length-8;e.i=0;try{if(n(e,i),e.i<t)return e.bytes}catch(o){if(e.i<t)throw o}v(e)}}function b(e,n,i){const{length:t}=i;return t<4096?(e.bytes.set(i),e.i=0,n(e)):n(y(i))}function y(e){return{i:0,bytes:e,view:new DataView(e.buffer,e.byteOffset,e.byteLength)}}function u(e,n){return{ser:e,des:n}}const T={encode(e,n){const{length:i}=n;for(let t=0;t<i;t++)e.view.setUint8(e.i++,n.charCodeAt(t))},decode(e,n){const i=new Array(n);for(let t=0;t<n;t++)i[t]=e.view.getUint8(e.i++);return String.fromCharCode(...i)}},k={encode(e,n){const{length:i}=n;for(let t=0;t<i;t++)e.view.setUint16(e.i,n.charCodeAt(t)),e.i+=2},decode(e,n){const i=n/2,t=new Array(i);for(let o=0;o<i;o++)t[o]=e.view.getUint16(e.i),e.i+=2;return String.fromCharCode(...t)}},L=new TextEncoder,O=new TextDecoder,P={encode(e,n){e.i+=L.encodeInto(n,e.bytes.subarray(e.i)).written},decode:(e,n)=>O.decode(e.bytes.subarray(e.i,e.i+=n))},V={encode(e,n){const{length:i}=n;for(let t=0;t<i;t++){const o=n.charCodeAt(t);if(o<128)e.view.setUint8(e.i,o),e.i++;else if(o<2048){const r=(o&1984)<<2,f=o&63;e.view.setUint16(e.i,r|f|49280),e.i+=2}else if(o<55296||o>=57344){const r=(o&61440)<<12,f=(o&4032)<<10,w=(o&63)<<8;e.view.setUint32(e.i,r|f|w|3766517760),e.i+=3}else{const r=n.codePointAt(t++),f=(r&1835008)<<6,w=(r&258048)<<4,a=(r&4032)<<2,d=r&63;e.view.setUint32(e.i,f|w|a|d|4034953344),e.i+=4}}},decode(e,n){const i=[],t=e.i+n;for(;e.i<t;){const o=e.view.getUint8(e.i);if(o<192)i.push(o),e.i++;else if(o<224){const r=e.view.getUint8(e.i+1);e.i+=2,i.push((o&31)<<6|r&63)}else if(o<240){const r=e.view.getUint8(e.i+1),f=e.view.getUint8(e.i+2);e.i+=3,i.push((o&15)<<12|(r&63)<<6|f&63)}else{const r=e.view.getUint32(e.i),f=(o&7)<<18,w=(r&4128768)>>4,a=(r&16128)>>2,d=r&63;i.push(f|w|a|d),e.i+=4}}return String.fromCodePoint(...i)}},M=(e,n)=>u((i,t)=>{const{length:o}=t;n.ser(i,o);for(let r=0;r<o;r++)e.ser(i,t[r])},i=>{const t=n.des(i),o=new Array(t);for(let r=0;r<t;r++)o[r]=e.des(i);return o}),_=e=>u((n,i)=>{i==null?n.view.setUint8(n.i++,0):(n.view.setUint8(n.i++,1),e.ser(n,i))},n=>n.view.getUint8(n.i++)?e.des(n):void 0),$=(e,n,i)=>u((t,o)=>{const{length:r}=Object.keys(o);i.ser(t,r);for(const f in o)e.ser(t,f),n.ser(t,o[f])},t=>{const o=i.des(t),r={};for(let f=0;f<o;f++)r[e.des(t)]=n.des(t);return r}),E=(e,n)=>u((i,t)=>{const o=i.i;n.ser(i,0);const r=i.i;e.encode(i,t);const f=i.i,w=f-r;i.i=o,n.ser(i,w),i.i=f},i=>e.decode(i,n.des(i))),q=e=>u((n,i)=>{const{byteLength:t}=i;e.ser(n,t),n.bytes.set(i,n.i),n.i+=t},n=>{const i=e.des(n);return n.bytes.subarray(n.i,n.i+=i)}),z=u((e,n)=>void e.view.setUint8(e.i++,+n),e=>!!e.view.getUint8(e.i++));function G({ser:e,des:n}){const i=l();return{ser:e,des:n,toBytes:t=>g(i,e,t).slice(0,i.i),toUnsafeBytes:t=>g(i,e,t).subarray(0,i.i),fromBytes:t=>b(i,n,t)}}const U=u((e,n)=>e.view.setUint8(e.i++,n),e=>e.view.getUint8(e.i++)),c=u((e,n)=>{e.view.setUint16(e.i,n),e.i+=2},e=>{const n=e.view.getUint16(e.i);return e.i+=2,n}),h=u((e,n)=>{e.view.setUint32(e.i,n),e.i+=4},e=>{const n=e.view.getUint32(e.i);return e.i+=4,n}),m=u((e,n)=>{e.view.setBigUint64(e.i,n),e.i+=8},e=>{const n=e.view.getBigUint64(e.i);return e.i+=8,n}),C=u((e,n)=>e.view.setInt8(e.i++,n),e=>e.view.getInt8(e.i++)),A=u((e,n)=>{e.view.setInt16(e.i,n),e.i+=2},e=>{const n=e.view.getInt16(e.i);return e.i+=2,n}),I=u((e,n)=>{e.view.setInt32(e.i,n),e.i+=4},e=>{const n=e.view.getInt32(e.i);return e.i+=4,n}),B=u((e,n)=>{e.view.setBigInt64(e.i,n),e.i+=8},e=>{const n=e.view.getBigInt64(e.i);return e.i+=8,n}),j=u((e,n)=>{e.view.setFloat32(e.i,n),e.i+=4},e=>{const n=e.view.getFloat32(e.i);return e.i+=4,n}),D=u((e,n)=>{e.view.setFloat64(e.i,n),e.i+=8},e=>{const n=e.view.getFloat64(e.i);return e.i+=8,n}),H={uint8:U,uint16:c,uint32:h,int8:C,int16:A,int32:I,float32:j,float64:D,bigUint64:m,bigInt64:B},J=(e,n)=>H[`${e}${n}`],F=e=>{const n=e instanceof Array?()=>[]:()=>({});return u((i,t)=>{for(const o in e)e[o].ser(i,t[o])},i=>{const t=n();for(const o in e)t[o]=e[o].des(i);return t})},K=(...e)=>F(e);s.array=M,s.bigInt64=B,s.bigUint64=m,s.boolean=z,s.bytes=q,s.contextDes=b,s.contextFromBytes=y,s.contextSer=g,s.createContext=l,s.define=u,s.float32=j,s.float64=D,s.growContext=v,s.int16=A,s.int32=I,s.int8=C,s.latin1=T,s.number=J,s.optional=_,s.record=$,s.string=E,s.struct=F,s.tuple=K,s.ucs2=k,s.uint16=c,s.uint32=h,s.uint8=U,s.use=G,s.utf8=P,s.utf8js=V,Object.defineProperty(s,"__esModule",{value:!0}),s[Symbol.toStringTag]="Module"});
